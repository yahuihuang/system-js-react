<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System JS in React</title>
</head>

<body>
    <script type="systemjs-importmap">
            {
                "imports": {
                    "react":"https://cdn.bootcdn.net/ajax/libs/react/17.0.2/umd/react.production.min.js",
                    "react-dom":"https://cdn.bootcdn.net/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"
                }
            }
        </script>

    <div id="root"></div>
    <script>
        // 可動態加載模塊，可加載遠程連結
        // ADM依賴前置 引入index.js需先加載react, react-dom
        function SystemJS() {

        }

        function load(id) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = id;
                script.async = true;
                document.head.appendChild(script);
                script.addEventListener('load', function() {
                    console.log('script load OK(腳本加載完成)!');
                })
            })
        }

        SystemJS.prototype.import = function (id) {
            return new Promise((resolve, reject) => {
                const lastSepIndex = window.location.href.lastIndexOf('/');
                const baseURL = location.href.slice(0, lastSepIndex + 1);
                console.log('baseURL: ' + baseURL);
                if (id.startsWith('./')) {
                    resolve(baseURL + id.slice(2))
                }
            }).then(id => {
                console.log('id: ' + id);
                return load(id);
            })
        }

        let System = new SystemJS();

        System.import('./index.js').then(() => {

        })
    </script>
</body>

</html>